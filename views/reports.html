<% include layout/header.html %>

<section class="reports"><div class="inner">
  <% if (results) { %>


    <strong>
    <% if (query) { %>
      <%= results.hits.total %> reports matching "<%= query %>".
    <% } else { %>
      <%= results.hits.total %> reports.
    <% } %>
    </strong>

    <% hits = results.hits.hits %>
    <% if (hits.length > 0) { %>
      <ul>
        <% for (var i=0; i<hits.length; i++) { %>
          <% report = hits[i]._source %>
          <% highlight = hits[i].highlight %>
          <li>
            <h2>
              <a href="/report/<%= report.inspector %>/<%= report.report_id %>">
                <%= report.title %>
              </a>
            </h2>
            <h4>
              <a href="<%= report.inspector_url %>">
                <%= report.agency_name %></a>
              &mdash;
              <%= report.published_on %>
              <% if (report.url) { %>
                &mdash;
                <a href="<%= report.url %>">
                  Full report
                </a>
                <% if (report.file_type == "pdf") { %>
                  (PDF)
                <% } %>
              <% } else if (report.unreleased) { %>
                &mdash;
                <% if (report.missing) { %>
                  Unreleased/Missing
                <% } else { %>
                  Unreleased
                <% } %>
              <% } %>

              <% if (report.landing_url) { %>
                &mdash;
                <a href="<%= report.landing_url %>">Summary</a>
              <% } %>
            </h4>
            <p>
              <% if (highlight && highlight.text) { %>
                …<%- helpers.truncate(highlight.text[0], 500) %>…
              <% } else if (highlight && highlight.summary) { %>
                …<%- helpers.truncate(highlight.summary[0], 500) %>…
              <% } else { %>
                No excerpt available.
              <% } %>
            </p>
          </li>
        <% } %>
      </ul>
    <% } else { %>
      <p>
        No results right now.
      </p>
    <% } %>
  <% } else { %>
    Error performing the search!
  <% } %>
</div></section>

<% include layout/footer.html %>
